var t=Object.defineProperty,e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,r=(t,r)=>{for(var a in r||(r={}))s.call(r,a)&&n(t,a,r[a]);if(e)for(var a of e(r))i.call(r,a)&&n(t,a,r[a]);return t};import{a,j as h,R as o}from"./vendor.9ccb11d5.js";import{u as _,v as c,a as l,j as u,M as y}from"./Message.2e9876b9.js";const m=[];for(let f=0;f<256;f++)m[f]=(f<16?"0":"")+f.toString(16);class w{constructor(t=0,e=0,s=0,i=1){this._x=t,this._y=e,this._z=s,this._w=i}static slerp(t,e,s,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),s.slerpQuaternions(t,e,i)}static slerpFlat(t,e,s,i,n,r,a){let h=s[i+0],o=s[i+1],_=s[i+2],c=s[i+3];const l=n[r+0],u=n[r+1],y=n[r+2],m=n[r+3];if(0===a)return t[e+0]=h,t[e+1]=o,t[e+2]=_,void(t[e+3]=c);if(1===a)return t[e+0]=l,t[e+1]=u,t[e+2]=y,void(t[e+3]=m);if(c!==m||h!==l||o!==u||_!==y){let t=1-a;const e=h*l+o*u+_*y+c*m,s=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const n=Math.sqrt(i),r=Math.atan2(n,e*s);t=Math.sin(t*r)/n,a=Math.sin(a*r)/n}const n=a*s;if(h=h*t+l*n,o=o*t+u*n,_=_*t+y*n,c=c*t+m*n,t===1-a){const t=1/Math.sqrt(h*h+o*o+_*_+c*c);h*=t,o*=t,_*=t,c*=t}}t[e]=h,t[e+1]=o,t[e+2]=_,t[e+3]=c}static multiplyQuaternionsFlat(t,e,s,i,n,r){const a=s[i],h=s[i+1],o=s[i+2],_=s[i+3],c=n[r],l=n[r+1],u=n[r+2],y=n[r+3];return t[e]=a*y+_*c+h*u-o*l,t[e+1]=h*y+_*l+o*c-a*u,t[e+2]=o*y+_*u+a*l-h*c,t[e+3]=_*y-a*c-h*l-o*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const s=t._x,i=t._y,n=t._z,r=t._order,a=Math.cos,h=Math.sin,o=a(s/2),_=a(i/2),c=a(n/2),l=h(s/2),u=h(i/2),y=h(n/2);switch(r){case"XYZ":this._x=l*_*c+o*u*y,this._y=o*u*c-l*_*y,this._z=o*_*y+l*u*c,this._w=o*_*c-l*u*y;break;case"YXZ":this._x=l*_*c+o*u*y,this._y=o*u*c-l*_*y,this._z=o*_*y-l*u*c,this._w=o*_*c+l*u*y;break;case"ZXY":this._x=l*_*c-o*u*y,this._y=o*u*c+l*_*y,this._z=o*_*y+l*u*c,this._w=o*_*c-l*u*y;break;case"ZYX":this._x=l*_*c-o*u*y,this._y=o*u*c+l*_*y,this._z=o*_*y-l*u*c,this._w=o*_*c+l*u*y;break;case"YZX":this._x=l*_*c+o*u*y,this._y=o*u*c+l*_*y,this._z=o*_*y-l*u*c,this._w=o*_*c-l*u*y;break;case"XZY":this._x=l*_*c-o*u*y,this._y=o*u*c-l*_*y,this._z=o*_*y+l*u*c,this._w=o*_*c+l*u*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],r=e[1],a=e[5],h=e[9],o=e[2],_=e[6],c=e[10],l=s+a+c;if(l>0){const t=.5/Math.sqrt(l+1);this._w=.25/t,this._x=(_-h)*t,this._y=(n-o)*t,this._z=(r-i)*t}else if(s>a&&s>c){const t=2*Math.sqrt(1+s-a-c);this._w=(_-h)/t,this._x=.25*t,this._y=(i+r)/t,this._z=(n+o)/t}else if(a>c){const t=2*Math.sqrt(1+a-s-c);this._w=(n-o)/t,this._x=(i+r)/t,this._y=.25*t,this._z=(h+_)/t}else{const t=2*Math.sqrt(1+c-s-a);this._w=(r-i)/t,this._x=(n+o)/t,this._y=(h+_)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs((e=this.dot(t),s=-1,i=1,Math.max(s,Math.min(i,e)))));var e,s,i}rotateTowards(t,e){const s=this.angleTo(t);if(0===s)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,r=t._w,a=e._x,h=e._y,o=e._z,_=e._w;return this._x=s*_+r*a+i*o-n*h,this._y=i*_+r*h+n*a-s*o,this._z=n*_+r*o+s*h-i*a,this._w=r*_-s*a-i*h-n*o,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const s=this._x,i=this._y,n=this._z,r=this._w;let a=r*t._w+s*t._x+i*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const h=1-a*a;if(h<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*s+e*this._x,this._y=t*i+e*this._y,this._z=t*n+e*this._z,this.normalize(),this._onChangeCallback(),this}const o=Math.sqrt(h),_=Math.atan2(o,a),c=Math.sin((1-e)*_)/o,l=Math.sin(e*_)/o;return this._w=r*c+this._w*l,this._x=s*c+this._x*l,this._y=i*c+this._y*l,this._z=n*c+this._z*l,this._onChangeCallback(),this}slerpQuaternions(t,e,s){this.copy(t).slerp(e,s)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}w.prototype.isQuaternion=!0;const d={dataChannelName:"Data channel",rtcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},reconnectTries:1};function g(t){const[e]=_("connection-id",c()),s=l(`wss://json-relay-server.onrender.com/ws/${e}`),i=function(t,e,s){s=r(r({},d),s);const[i,n]=a.exports.useState({status:"connecting"});return a.exports.useEffect((()=>{if("connecting"!=i.status||null==e)return;const r=new RTCPeerConnection(s.rtcConfig),a=r.createDataChannel(s.dataChannelName,{maxRetransmits:1,ordered:!1});let h;a.onopen=()=>{n({status:"connected",onMessage:t=>(a.addEventListener("message",t),()=>a.removeEventListener("message",t)),sendMessage:t=>{a.send(t)}})},r.onicecandidate=s=>{null!=s.candidate&&e.sendSignalingMessage(t,s.candidate.toJSON())},r.oniceconnectionstatechange=()=>{switch(r.iceConnectionState){case"disconnected":case"failed":n((t=>({status:"connected"===t.status?"connecting":"error"})))}},e.onSignalingMessage((async(t,e)=>{clearTimeout(h),"type"in e?await r.setRemoteDescription(e):"candidate"in e&&await r.addIceCandidate(e)})),r.createOffer().then((async s=>{h=window.setTimeout((()=>{n((({status:t})=>({status:"error"!==t?"empty":"error"})))}),5e3),await r.setLocalDescription(s),e.sendSignalingMessage(t,s)}))}),[i.status,e,t]),i}(t,a.exports.useMemo((()=>s.socket?u(s.socket,e):void 0),[s.socket,e]));return a.exports.useMemo((()=>["connected"!==s.status?s.status:i.status,"connected"===i.status?(...t)=>{i.sendMessage(new Float32Array(t))}:null]),[s.status,i])}var x=h("button")`
  all: unset;
  padding: 1em 1.2em;
  border-radius: 0.5em;
  user-select: none;
  text-transform: uppercase;
  letter-spacing: 2px;
  font-size: 0.8em;
  color: pink;
  background-color: hotpink;
  appearance: none;
  margin: 0;
`,p=Math.PI/180;function z({id:t}){const[e,s]=g(t),[i,n]=a.exports.useState(!1);if(a.exports.useEffect((()=>{let t=!1;const e=e=>{t||(n(!0),t=!0);const i=(r=e.alpha,a=e.beta,h=e.gamma,o=a?a*p:0,_=h?h*p:0,c=r?r*p:0,l=Math.cos(o/2),u=Math.cos(_/2),y=Math.cos(c/2),m=Math.sin(o/2),d=Math.sin(_/2),g=Math.sin(c/2),new w(m*u*y-l*d*g,l*d*y+m*u*g,l*u*g+m*d*y,l*u*y-m*d*g));var r,a,h,o,_,c,l,u,y,m,d,g;null==s||s(i.x,i.y,i.z,i.w)};return addEventListener("deviceorientation",e),()=>removeEventListener("deviceorientation",e)}),[s]),!1===i)return o.createElement(b,null);switch(e){case"connected":return o.createElement(y,null,"Your phone is now visualized on the main screen");case"connecting":return o.createElement(y,null,"Connecting");case"error":return o.createElement(y,null,"Could not connect, make sure phone is connected to the same Wifi as the computer");case"empty":return o.createElement(y,null,"No one seems to be here anymore ðŸ˜¢");default:return null}}const b=()=>o.createElement(o.Fragment,null,o.createElement(y,null,"To use the phone gyro, we must first get your permission."),o.createElement(x,{onClick:()=>DeviceOrientationEvent.requestPermission().then((t=>"granted"!==t&&alert("Did not get permissions. Browser app must be restarted to try again.")))},"OK, ask away!"));export{z as default};
