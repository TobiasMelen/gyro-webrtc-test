var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;import{r,v as s,j as c,R as i}from"./vendor.ff41f632.js";import{u as l,M as u}from"./useWsRelay.30ad28a6.js";const d={alpha:0,beta:0,gamma:0,x:0,y:0,z:0};function m(e){const t=r.exports.useMemo((()=>{var e;return null!=(e=localStorage["connection-id"])?e:s()}),[]);r.exports.useEffect((()=>localStorage.setItem("connection-id",t)));const n=l(`wss://signaling-server.tobbes.site/${t}`),[o,a]=r.exports.useState(),[c,i]=r.exports.useState("connecting");return r.exports.useEffect((()=>{if("connected"!==n.status||null!=o)return;const r=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),s=r.createDataChannel("Client data channel",{maxRetransmits:1,ordered:!1});let c;s.onopen=()=>{a((()=>e=>s.send(JSON.stringify(e)))),i("connected")},r.onicecandidate=o=>{null!=o.candidate&&n.socket.send({to:e,from:t,data:o.candidate.toJSON()})},r.oniceconnectionstatechange=()=>{switch(r.iceConnectionState){case"disconnected":case"failed":i("error")}},n.socket.addListener((async({data:e})=>{clearTimeout(c),"answer"===e.type?await r.setRemoteDescription(e):"candidate"in e&&await r.addIceCandidate(e)})),r.createOffer().then((async o=>{c=window.setTimeout((()=>{i((e=>"error"!==e?"empty":"error"))}),1e3),await r.setLocalDescription(o),n.socket.send({data:o,to:e,from:t})}))}),[o,e,n]),[o,"connected"===n.status?c:n.socket]}var p=c("button")`
  all: unset;
  padding: 1em 1.2em;
  border-radius: 0.5em;
  user-select: none;
  text-transform: uppercase;
  letter-spacing: 2px;
  font-size: 0.8em;
  color: pink;
  background-color: hotpink;
  appearance: none;
  margin: 0;
`;function f({id:e}){const[s,c]=r.exports.useState(!1),[l,f]=m(e),g=r.exports.useMemo((()=>((e,r)=>{for(var s in r||(r={}))n.call(r,s)&&a(e,s,r[s]);if(t)for(var s of t(r))o.call(r,s)&&a(e,s,r[s]);return e})({},d)),[e]);return r.exports.useEffect((()=>{if("connected"!==f||null==l)return;const e=({rotationRate:e,interval:t})=>{var n,o,a;c(!0);const r=t/100;g.alpha+=(null!=(n=null==e?void 0:e.alpha)?n:0)*r,g.beta+=(null!=(o=null==e?void 0:e.beta)?o:0)*r,g.gamma+=(null!=(a=null==e?void 0:e.gamma)?a:0)*r,l(g)};return addEventListener("devicemotion",e),()=>removeEventListener("deviceMotion",e)}),[f]),!1===s?i.createElement(i.Fragment,null,i.createElement(u,null,"To use the phone gyro, we must first get your permission."),i.createElement(p,{onClick:()=>DeviceMotionEvent.requestPermission().then((e=>"granted"!==e&&alert("Did not get permissions. Browser app must be restarted to try again.")))},"OK, ask away!")):i.createElement(u,null,"Your phone is now tracked on other screen")}export{f as default};
