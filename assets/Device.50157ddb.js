var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;import{r as a,v as s,j as c,R as i}from"./vendor.ff41f632.js";import{u as l,M as u}from"./useWsRelay.5f0c154d.js";const d={alpha:0,beta:0,gamma:0,x:0,y:0,z:0};function m(e){const t=a.exports.useMemo((()=>{var e;return null!=(e=localStorage["connection-id"])?e:s()}),[]);a.exports.useEffect((()=>localStorage.setItem("connection-id",t)));const n=l(`wss://signaling-server.tobbes.site/${t}`),[o,r]=a.exports.useState(),[c,i]=a.exports.useState("connecting");return a.exports.useEffect((()=>{if("connected"!==n.status||null!=o)return;const a=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),s=a.createDataChannel("Client data channel",{maxRetransmits:1,ordered:!1});let c;s.onopen=()=>{r((()=>e=>s.send(JSON.stringify(e)))),i("connected")},a.onicecandidate=o=>{null!=o.candidate&&n.socket.send({to:e,from:t,data:o.candidate.toJSON()})},a.oniceconnectionstatechange=()=>{switch(a.iceConnectionState){case"disconnected":case"failed":i("error")}},n.socket.addListener((async({data:e})=>{clearTimeout(c),"answer"===e.type?await a.setRemoteDescription(e):"candidate"in e&&await a.addIceCandidate(e)})),a.createOffer().then((async o=>{c=window.setTimeout((()=>{i((e=>"error"!==e?"empty":"error"))}),1e3),await a.setLocalDescription(o),n.socket.send({data:o,to:e,from:t})}))}),[o,e,n]),[o,"connected"===n.status?c:n.socket]}var p=c("button")`
  all: unset;
  padding: 1em 1.2em;
  border-radius: 0.5em;
  user-select: none;
  text-transform: uppercase;
  letter-spacing: 2px;
  font-size: 0.8em;
  color: pink;
  background-color: hotpink;
  appearance: none;
  margin: 0;
`;function f({id:e}){const[s,c]=a.exports.useState(!1),[l,f]=m(e),g=a.exports.useMemo((()=>((e,a)=>{for(var s in a||(a={}))n.call(a,s)&&r(e,s,a[s]);if(t)for(var s of t(a))o.call(a,s)&&r(e,s,a[s]);return e})({},d)),[e]);return a.exports.useEffect((()=>{if("connected"!==f||null==l)return;const e=({rotationRate:e,interval:t})=>{var n,o,r;c(!0);const a=t/100;g.alpha+=(null!=(n=null==e?void 0:e.alpha)?n:0)*a,g.beta+=(null!=(o=null==e?void 0:e.beta)?o:0)*a,g.gamma+=(null!=(r=null==e?void 0:e.gamma)?r:0)*a,l(g)};return addEventListener("devicemotion",e),()=>removeEventListener("deviceMotion",e)}),[f]),!1===s?i.createElement(i.Fragment,null,i.createElement(u,null,"To use the phone gyro, we must first get your permission."),i.createElement(p,{onClick:()=>DeviceMotionEvent.requestPermission().then((e=>"granted"!==e&&alert("Did not get permissions. Browser app must be restarted to try again.")))},"OK, ask away!")):i.createElement(u,null,"Your phone is now tracked on other screen")}export{f as default};
